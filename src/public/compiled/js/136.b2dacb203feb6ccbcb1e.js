"use strict";(self.webpackChunksrc=self.webpackChunksrc||[]).push([[136],{36286:function(e,t,a){a.d(t,{km:function(){return s},oY:function(){return l},zv:function(){return r},pB:function(){return o},Cq:function(){return i},OW:function(){return c},Td:function(){return m}});var n=a(99677);function s(e){return n.Z.getState()["SKIPCLEAR/GlobalSettings"][e]}function l(){return u("name")}function r(){return u("id")}function o(){return u("uuid")}function i(){return u("swim_england_code")}function c(e){return u("club_logo_path")+e}function u(e){return n.Z.getState()["SKIPCLEAR/Tenant"][e]}function m(e){document.title=e+" - "+s("club_name")}},53136:function(e,t,a){a.r(t),a.d(t,{default:function(){return Z}});var n=a(67294),s=a(36286),l=a(62598),r=a(77289),o=a(3330),i=a(35005),c=a(88375),u=a(39711),m=a(96974),d=a(50533),p=a(21073),g=a(9669),h=a.n(g),w=a(1627),b=a(79909);const E=r.Ry().shape({emailAddress:r.Z_().email("Your email address must be valid").required("You must provide an email address"),password:r.Z_().required("You must provide a password"),rememberMe:r.Xg()});var f=(0,d.$j)(p.K,p.ZS)((e=>{const t="undefined"!=typeof PublicKeyCredential,a=(0,m.TH)(),[r]=(0,u.lr)();(0,n.useEffect)((()=>{s.Td("Login"),a.state&&a.state.location&&e.setLoginDetails({target:a.state.location.pathname})}),[]);const[d,p]=(0,n.useState)(null),[g,f]=(0,n.useState)(""),[v,y]=(0,n.useState)(!1),[C,Z]=(0,n.useState)(null),[S,_]=(0,n.useState)(null),k=(0,n.useRef)(),[N,A]=(0,n.useState)(null),T=(0,n.useRef)(),[F,U]=(0,n.useState)(null),L=(0,n.useRef)(),[M,I]=(0,n.useState)(null),K={type:"danger",message:"Passkey authentication failed."},P=e=>{"passkey"===e?N.show():N.hide(),"sso"===e?M.show():M.hide(),"password"===e?F.show():F.hide()};(0,n.useEffect)((()=>{A(new b.Collapse(k.current,{toggle:!1})),U(new b.Collapse(T.current,{toggle:!1})),I(new b.Collapse(L.current,{toggle:!1}))}),[]),(0,n.useEffect)((()=>{null!==S&&P(S?"password":"passkey")}),[S]);const R=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t)return!1;const{data:a}=await h().get("/api/auth/login/has-webauthn",{params:{email:e||g}});return y(a.has_webauthn),a.is_sso?(Z(a.sso_url),P("sso")):(Z(null),P(a.has_webauthn?"passkey":"password")),a.has_webauthn},V=function(e){let{actionUrl:t="/login",actionHeader:a={},optionsUrl:n="/login/options"}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async e=>{let{credentialsGetProps:l,...r}=e;const o=await(0,w.r0)(r,n,s),i=await o.json(),c=(0,w.u3)(i),u=await navigator.credentials.get({publicKey:c,...l}),m=(0,w.TD)(u),d=await(0,w.r0)(m,t,a);if(!d.ok)throw d;const p=await d.text();return""!==p?JSON.parse(p):p}}({actionUrl:"/api/auth/login/webauthn-verify",optionsUrl:"/api/auth/login/webauthn-challenge"}),z=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var n,s;const e={target:null==a||null===(n=a.state)||void 0===n||null===(s=n.location)||void 0===s?void 0:s.pathname};if(g&&(e.username=g,!await R()))return void p({variant:"warning",message:"There are no passkeys registered for this account."});t&&(e.credentialsGetProps={mediation:"conditional"});const l=await V(e);l.success?(window.location.replace(l.redirect_url),p(null)):(p(K),console.error(d))}catch(e){p(K),console.error(e)}};(0,n.useEffect)((()=>{(async()=>{await(async()=>{PublicKeyCredential.isConditionalMediationAvailable&&PublicKeyCredential.isConditionalMediationAvailable()&&await z(null,!0)})()})()}),[]);const G=()=>n.createElement(i.Z,{variant:"secondary",type:"button",onClick:()=>_(!S),disabled:!1},S?"Use a passkey to login":"Use a password to login");return n.createElement(n.Fragment,null,d&&n.createElement("div",{className:"alert alert-danger"},d.message),a.state&&a.state.successfulReset&&n.createElement(c.Z,{variant:"success"},n.createElement("p",{className:"mb-0"},n.createElement("strong",null,"Your password was reset successfully"))),n.createElement(l.J9,{validationSchema:E,onSubmit:async(t,a)=>{let{setSubmitting:n}=a;n(!0);try{const a=await h().post("/api/auth/login/login",{email_address:t.emailAddress,password:t.password});a.data.success?(e.setType("twoFactor"),e.setLoginDetails({...a.data,remember_me:t.rememberMe})):p({type:"danger",message:a.data.message})}catch(e){p({type:"danger",message:e.message})}n(!1)},initialValues:{emailAddress:e.emailAddress||r.get("email")||"",password:"",rememberMe:e.rememberMe||!0}},(e=>{let{handleSubmit:t,handleChange:a,handleBlur:s,values:l,touched:r,isValid:c,errors:m,isSubmitting:d,dirty:p}=e;const g=!v&&r.emailAddress&&!m.emailAddress||S;return n.createElement(o.Z,{noValidate:!0,onSubmit:t,onBlur:s},n.createElement("div",{className:"mb-3"},n.createElement(o.Z.Group,{controlId:"emailAddress"},n.createElement(o.Z.Label,null,"Email address"),n.createElement(o.Z.Control,{type:"text",name:"emailAddress",value:l.emailAddress,onChange:async e=>{a(e),f(e.target.value),await R(e.target.value)},isValid:r.emailAddress&&!m.emailAddress,isInvalid:r.emailAddress&&m.emailAddress,size:"lg",autoComplete:"username webauthn"}),m.emailAddress&&n.createElement(o.Z.Control.Feedback,{type:"invalid"},m.emailAddress))),n.createElement("div",{className:"collapse",ref:L},n.createElement("div",{className:"mb-5"},n.createElement(i.Z,{href:C,size:"lg",type:"button"},"Login"))),n.createElement("div",{className:"collapse",ref:k},n.createElement("div",{className:"mb-5"},n.createElement("div",{className:"row justify-content-between align-items-center"},n.createElement("div",{className:"col-sm-auto"},n.createElement(i.Z,{size:"lg",type:"button",onClick:z,disabled:!1},"Login with passkey"),n.createElement("div",{className:"mb-2 d-sm-none"})),n.createElement("div",{className:"col-sm-auto"},G())))),n.createElement("div",{className:"collapse",ref:T},n.createElement("div",{className:"mb-3"},n.createElement(o.Z.Group,{controlId:"password"},n.createElement(o.Z.Label,null,"Password"),n.createElement(o.Z.Control,{type:"password",name:"password",value:l.password,onChange:a,isValid:r.password&&!m.password,isInvalid:r.password&&m.password,size:"lg",autoComplete:"current-password"}),m.password&&n.createElement(o.Z.Control.Feedback,{type:"invalid"},m.password))),n.createElement(o.Z.Group,{className:"mb-3"},n.createElement(o.Z.Check,{name:"rememberMe",label:"Keep me logged in",onChange:a,checked:l.rememberMe,isInvalid:!!m.rememberMe,feedback:m.rememberMe,feedbackType:"invalid",id:"rememberMe"})),g&&n.createElement("div",{className:"mb-5"},n.createElement("div",{className:"row justify-content-between align-items-center"},n.createElement("div",{className:"col-sm-auto"},n.createElement(i.Z,{size:"lg",type:"submit",disabled:!p||!c||d},"Login"),n.createElement("div",{className:"mb-2 d-sm-none"})),n.createElement("div",{className:"col-sm-auto"},G())))),n.createElement("div",{className:"mb-5"},n.createElement("p",null,"New member? Your club will create an account for you and send you a link to get started."),n.createElement("span",null,n.createElement(u.rU,{to:"/login/forgot-password",className:"btn btn-dark"},"Forgot password?"))))})))}));const v=r.Ry().shape({authCode:r.Z_().length(6,"Authentication codes are 6 digits").required("You must enter an authentication code").matches(/[0-9]{6,6}/,"Authentication codes are 6 digits"),setUpTwoFactor:r.Xg()}),y=()=>{const{values:e,submitForm:t}=(0,l.u6)();return n.useEffect((()=>{6===e.authCode.length&&t()}),[e,t]),null};var C=(0,d.$j)(p.K,p.ZS)((e=>{const[t,a]=(0,n.useState)(!0),[r,u]=(0,n.useState)(!1),[m,d]=(0,n.useState)({show:!1,message:null}),p=async()=>{a(!1);const t=await h().post("/api/auth/login/resend-two-factor",{});t.data.success?(u(!0),e.setLoginDetail("two_factor_method","email")):d({show:!0,message:t.data.message}),new Promise((function(){setTimeout((function(){a(!0)}),5e3)}))};s.Td("Confirm Login");let g="We've sent a confirmation code to your registered email address",w="Resend email";return"totp"===e.two_factor_method&&(g="Use the code from your Two Factor Authentication app to confirm your sign in",w="Resend email"),n.createElement(n.Fragment,null,m.show&&n.createElement(c.Z,{variant:"danger"},n.createElement("p",{className:"mb-0"},n.createElement("strong",null,"Oops")),n.createElement("p",{className:"mb-0"},m.message)),n.createElement(l.J9,{validationSchema:v,onSubmit:async(t,a)=>{let{setSubmitting:n}=a;n(!0);try{const a=await h().post("/api/auth/login/two-factor",{auth_code:t.authCode,target:e.target,setup_two_factor:t.setUpTwoFactor,remember_me:e.remember_me||!1});a.data.success?(d({show:!1,message:null}),window.location.replace(a.data.redirect_url)):(n(!1),d({show:!0,message:a.data.message}))}catch(e){d({show:!0,message:"A network error occurred"}),n(!1)}},initialValues:{authCode:"",setUpTwoFactor:!1}},(a=>{let{handleSubmit:s,handleChange:l,handleBlur:u,values:m,touched:d,isValid:h,errors:b,isSubmitting:E,dirty:f}=a;return n.createElement(o.Z,{noValidate:!0,onSubmit:s,onBlur:u},n.createElement("div",{className:"mb-3"},n.createElement(o.Z.Group,{controlId:"password"},n.createElement(o.Z.Label,null,"Authentication code"),n.createElement(o.Z.Control,{name:"authCode",autoFocus:!0,value:m.authCode,onChange:l,isValid:d.authCode&&!b.authCode,isInvalid:d.authCode&&b.authCode,size:"lg",placeholder:"654321",pattern:"[0-9]*",inputMode:"numeric",autoComplete:"one-time-code"}),b.authCode&&n.createElement(o.Z.Control.Feedback,{type:"invalid"},b.authCode))),!e.has_totp&&n.createElement(o.Z.Group,{className:"mb-3"},n.createElement(o.Z.Check,{name:"setUpTwoFactor",label:"Set up an authenticator app",onChange:l,isInvalid:!!b.setUpTwoFactor,feedback:b.setUpTwoFactor,id:"setUpTwoFactor",checked:m.setUpTwoFactor})),n.createElement("p",{className:"mb-5"},n.createElement(i.Z,{size:"lg",type:"submit",disabled:!f||!h||E},"Confirm login")),n.createElement("div",{className:"mb-5"},n.createElement("p",null,g),n.createElement("span",null,n.createElement(i.Z,{variant:"dark",onClick:p,disabled:!t},w),r&&n.createElement(c.Z,{variant:"info",className:"mt-2"},"We've resent your authentication code."))),n.createElement(y,null))})))})),Z=(0,d.$j)(p.K,p.ZS)((e=>((0,n.useEffect)((()=>(e.setType("login"),s.Td("Login"),()=>{})),[]),n.createElement(n.Fragment,null,"login"===e.login_page_type&&n.createElement(f,null),"twoFactor"===e.login_page_type&&n.createElement(C,null)))))}}]);
//# sourceMappingURL=136.b2dacb203feb6ccbcb1e.js.map